<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Mario Adventure</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { 
    width:100%; height:100%; overflow:hidden; 
    background: linear-gradient(to bottom, #1a2980, #26d0ce);
    font-family: 'Press Start 2P', cursive, sans-serif;
    touch-action: manipulation;
  }
  
  .game-container {
    position: relative;
    width: 100%;
    height: 100vh;
    overflow: hidden;
  }
  
  .game {
    position: relative; 
    width: 3000px; 
    height: 100vh;
    background: linear-gradient(to bottom, #5c94fc 0%, #87ceeb 100%);
    transition: transform 0.1s ease-out;
  }
  
  .cloud {
    position: absolute;
    background: white;
    border-radius: 50%;
    filter: drop-shadow(0 0 5px rgba(255,255,255,0.7));
    opacity: 0.8;
  }
  
  .ground {
    position: absolute; 
    bottom:0; 
    width:100%; 
    height:15vh;
    background: linear-gradient(to bottom, #228B22, #006400);
    border-top: 0.5vh solid #8B4513;
  }
  
  .player {
    position: absolute;
    width: 50px; 
    height: 60px;
    bottom:15vh;
    left: 5vw;
    z-index: 10;
    background: 
      linear-gradient(to right, #e52521 0%, #e52521 60%, #ff6b6b 100%),
      radial-gradient(circle at 30% 15%, #ffcc00 8%, transparent 8%);
    border-radius: 15px 15px 0 0;
    box-shadow: 0 6px 0 #b31d1a;
    transition: transform 0.1s ease;
  }
  
  .player.jumping {
    transform: scale(1.1, 0.9);
  }
  
  .coin {
    position: absolute; 
    width: 35px;
    height: 35px;
    background: radial-gradient(circle at 30% 30%, #ffd700, #daa520);
    border-radius:50%; 
    bottom: calc(15vh + 10px);
    animation: spin 1s linear infinite, float 2s ease-in-out infinite;
    box-shadow: 0 0 0 6px rgba(255, 215, 0, 0.3);
    z-index: 5;
  }
  
  .obstacle {
    position: absolute;
    bottom: 15vh;
  }

  .goomba, .spike, .block, .plant {
    width: 45px;
    height: 45px;
  }
  
  .goomba {
    background: 
      linear-gradient(to bottom, #8B4513 0%, #8B4513 70%, #6b3300 100%),
      radial-gradient(circle at 25% 25%, #000 5px, transparent 5px),
      radial-gradient(circle at 75% 25%, #000 5px, transparent 5px);
    border-radius: 50% 50% 0 0;
    animation: walk 1s linear infinite;
  }
  
  .spike {
    background: #444;
    clip-path: polygon(0 100%, 50% 0, 100% 100%);
  }
  
  .plant {
    background: 
      linear-gradient(to bottom, #006400, #228B22),
      radial-gradient(circle at 50% 30%, #ff0000 15%, transparent 15%);
    border-radius: 50% 50% 0 0;
    animation: pulse 1.5s ease-in-out infinite;
  }
  
  .block {
    background: #d2691e;
    border: 3px solid #8B4513;
    border-radius: 6px;
    box-shadow: inset 3px 3px 0 #e87d3e, inset -3px -3px 0 #8d4a0f;
  }
  
  .flag {
    position: absolute;
    width: 18px;
    height: 20vh; 
    background: linear-gradient(to right, #8B4513, #5D2906);
    bottom: 15vh;
    z-index: 8;
  }
  
  .flag::after {
    content:''; 
    position:absolute; 
    top:0; 
    left:18px;
    width: 90px; 
    height: 42px; 
    background: linear-gradient(to right, #e52521, #ff0000);
    border-radius: 0 6px 6px 0;
    animation: wave 1.5s infinite linear;
    transform-origin: left center;
  }
  
  .hud {
    position:fixed; 
    top:10px; 
    left:10px; 
    color:white; 
    font-size:16px; 
    text-shadow: 2px 2px 0 #000; 
    z-index:100;
    background: rgba(0,0,0,0.7);
    padding: 12px;
    border-radius: 6px;
    border: 3px solid gold;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .mobile-buttons {
    position:fixed; 
    bottom:20px; 
    width:100%;
    display:flex; 
    justify-content: space-between;
    align-items: flex-end;
    z-index:100;
    padding: 0 20px;
  }

  .btn-group {
    display: flex;
    gap: 15px;
    align-items: center;
  }

  .btn {
    width: 70px;
    height: 70px;
    background: rgba(139, 69, 19, 0.85); 
    color: white; 
    font-size: 24px;
    border: 3px solid #ffcc00; 
    border-radius: 50%; 
    display: flex; 
    align-items: center; 
    justify-content: center;
    user-select: none;
    box-shadow: 0 4px 0 #8d4a0f;
    text-shadow: 2px 2px 0 #000;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    cursor: pointer;
    transition: all 0.1s ease;
  }

  .btn:active { 
    transform: translateY(4px);
    box-shadow: 0 1px 0 #8d4a0f;
    background: rgba(226, 114, 31, 0.9);
  }

  .jump-btn {
    width: 80px;
    height: 80px;
    font-size: 28px;
    background: rgba(229, 37, 33, 0.85);
    border-color: #ffcc00;
  }

  .jump-btn:active {
    background: rgba(255, 60, 60, 0.9);
  }

  .level-up {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    color: gold;
    text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    text-align: center;
    white-space: nowrap;
  }

  .game-over {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    color: #ff0000;
    text-shadow: 0 0 10px #000, 0 0 20px #000;
    z-index: 200;
    opacity: 0;
    pointer-events: none;
    text-align: center;
  }

  .start-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 300;
    color: white;
    text-align: center;
    gap: 20px;
  }

  .start-title {
    font-size: 48px;
    color: #ffcc00;
    text-shadow: 4px 4px 0 #e52521;
    margin-bottom: 20px;
  }

  .start-btn {
    background: #e52521;
    color: white;
    border: none;
    padding: 15px 30px;
    font-size: 24px;
    font-family: 'Press Start 2P', cursive, sans-serif;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 0 #b31d1a;
    transition: all 0.1s;
  }

  .start-btn:active {
    transform: translateY(4px);
    box-shadow: 0 1px 0 #b31d1a;
  }

  .controls-info {
    font-size: 18px;
    margin-top: 30px;
    color: #aaa;
  }

  /* Mobile optimizations */
  @media (max-width: 768px) {
    .hud {
      font-size: 14px;
      padding: 10px;
      top: 5px;
      left: 5px;
    }
    
    .start-title {
      font-size: 36px;
    }
    
    .start-btn {
      font-size: 20px;
      padding: 12px 25px;
    }
    
    .controls-info {
      font-size: 16px;
    }
    
    .level-up, .game-over {
      font-size: 36px;
    }
  }

  @media (max-width: 480px) {
    .btn {
      width: 60px;
      height: 60px;
      font-size: 20px;
    }
    
    .jump-btn {
      width: 70px;
      height: 70px;
      font-size: 24px;
    }
    
    .mobile-buttons {
      bottom: 15px;
      padding: 0 15px;
    }
    
    .btn-group {
      gap: 10px;
    }
  }

  /* Hide mobile buttons on desktop */
  @media (min-width: 1024px) {
    .mobile-buttons {
      display: none;
    }
  }

  @keyframes spin {0%{transform:rotateY(0deg);}100%{transform:rotateY(360deg);}}
  @keyframes float {0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
  @keyframes walk {0%, 100% { transform: translateX(0); } 50% { transform: translateX(6px); }}
  @keyframes wave {0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); }}
  @keyframes pulse {0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); }}
  @keyframes levelUp {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.2); }
    30% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
    70% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
  }
  @keyframes gameOver {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }
</style>
</head>
<body>

<div class="game-container">
  <div class="game" id="game">
    <div class="ground"></div>
    <div class="player" id="player"></div>
    <!-- Coins will be added by JS -->
    <!-- Obstacles will be added by JS -->
    <!-- Flag will be added by JS -->
  </div>
  
  <div class="level-up" id="levelUp">Level Up!</div>
  <div class="game-over" id="gameOver">Game Over!</div>
</div>

<div class="hud">
  <div>Score: <span id="score">0</span></div>
  <div>Level: <span id="level">1</span></div>
  <div>Lives: <span id="lives">3</span></div>
</div>

<div class="mobile-buttons">
  <div class="btn-group">
    <div class="btn" id="leftBtn">←</div>
    <div class="btn" id="rightBtn">→</div>
  </div>
  <div class="btn-group">
    <div class="btn jump-btn" id="jumpBtn">↑</div>
  </div>
</div>

<div class="start-screen" id="startScreen">
  <div class="start-title">MARIO ADVENTURE</div>
  <div>Collect coins, avoid enemies</div>
  <div>Reach the flag to advance!</div>
  <button class="start-btn" id="startBtn">START GAME</button>
  <div class="controls-info">
    Desktop: Arrow keys or WASD<br>
    Mobile: Touch buttons
  </div>
</div>

<script>
// Game elements
const player = document.getElementById('player');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const livesEl = document.getElementById('lives');
const game = document.getElementById('game');
const levelUp = document.getElementById('levelUp');
const gameOver = document.getElementById('gameOver');
const startScreen = document.getElementById('startScreen');
const startBtn = document.getElementById('startBtn');

// Game state
let score = 0, level = 1, lives = 3;
let gameState = { x:100, y:0, vx:0, vy:0, isJumping:false, onGround:true };
const physics = { gravity:0.5, jumpStrength:14, moveSpeed:4, friction:0.8 };
let keys = {};
let obstacles = [];
let coins = [];
let flag;
let gameRunning = false;
let gameWidth = 3000;
let cameraX = 0;

// Mobile button states
let mobileControls = {
  left: false,
  right: false,
  jump: false
};

// Initialize game
function initGame() {
  // Clear existing elements
  document.querySelectorAll('.coin').forEach(c => c.remove());
  document.querySelectorAll('.obstacle').forEach(o => o.remove());
  document.querySelectorAll('.flag').forEach(f => f.remove());
  
  coins = [];
  obstacles = [];
  
  // Create clouds
  for (let i = 0; i < 12; i++) {
    const cloud = document.createElement('div');
    cloud.className = 'cloud';
    const size = 50 + Math.random() * 80;
    cloud.style.width = size + 'px';
    cloud.style.height = size/2 + 'px';
    cloud.style.top = (10 + Math.random() * 40) + '%';
    cloud.style.left = (Math.random() * 100) + '%';
    cloud.style.opacity = 0.6 + Math.random() * 0.4;
    game.insertBefore(cloud, game.firstChild);
  }
  
  // Setup first level
  setupLevel(level);
  
  // Reset player
  resetPlayer(true);
  
  // Update HUD
  scoreEl.textContent = score;
  levelEl.textContent = level;
  livesEl.textContent = lives;
  
  // Hide start screen
  startScreen.style.display = 'none';
  
  // Start game loop
  gameRunning = true;
  gameLoop();
}

function setupLevel(currentLevel) {
  // Clear existing elements
  coins.forEach(c => c.element.remove());
  obstacles.forEach(o => o.element.remove());
  if (flag) flag.element.remove();
  
  coins = [];
  obstacles = [];
  
  // Create coins based on level
  const coinPositions = [];
  const coinCount = 8 + currentLevel * 3;
  
  for (let i = 0; i < coinCount; i++) {
    let x;
    do {
      x = 300 + Math.random() * (gameWidth - 600);
    } while (coinPositions.some(pos => Math.abs(pos - x) < 120));
    
    coinPositions.push(x);
    createCoin(x);
  }
  
  // Create flag at end
  flag = createFlag(gameWidth - 200);
  
  // Create obstacles based on level
  if (currentLevel >= 1) {
    createObstacle('goomba', 600, 0);
    createObstacle('spike', 900, 0);
    createObstacle('block', 1200, 50);
  }
  
  if (currentLevel >= 2) {
    createObstacle('goomba', 1500, 0);
    createObstacle('plant', 1800, 0);
    createObstacle('spike', 2000, 0);
    createObstacle('block', 2200, 50);
  }
  
  if (currentLevel >= 3) {
    createObstacle('goomba', 2400, 0);
    createObstacle('spike', 2450, 0);
    createObstacle('spike', 2500, 0);
    createObstacle('plant', 2550, 0);
    createObstacle('block', 2600, 100);
  }
  
  if (currentLevel >= 4) {
    for (let i = 0; i < 5; i++) {
      createObstacle('spike', 2700 + i * 60, 0);
    }
    createObstacle('goomba', 2800, 0);
    createObstacle('plant', 2850, 0);
    createObstacle('block', 2900, 100);
  }
  
  if (currentLevel >= 5) {
    for (let i = 0; i < currentLevel; i++) {
      const types = ['goomba', 'spike', 'plant', 'block'];
      const type = types[Math.floor(Math.random() * types.length)];
      const x = 1000 + Math.random() * (gameWidth - 1500);
      const y = type === 'block' ? 50 + Math.random() * 50 : 0;
      createObstacle(type, x, y);
    }
  }
}

function createCoin(x) {
  const coin = document.createElement('div');
  coin.className = 'coin';
  coin.style.left = x + 'px';
  game.appendChild(coin);
  
  coins.push({
    element: coin,
    x: x,
    collected: false
  });
}

function createObstacle(type, x, y) {
  const obstacle = document.createElement('div');
  obstacle.className = `obstacle ${type}`;
  obstacle.style.left = x + 'px';
  obstacle.style.bottom = (15 * window.innerHeight / 100 + y) + 'px';
  game.appendChild(obstacle);
  
  obstacles.push({
    element: obstacle,
    type: type,
    x: x,
    y: y,
    width: 45,
    height: 45
  });
}

function createFlag(x) {
  const flagElement = document.createElement('div');
  flagElement.className = 'flag';
  flagElement.style.left = x + 'px';
  game.appendChild(flagElement);
  
  return {
    element: flagElement,
    x: x,
    width: 18,
    height: 20 * window.innerHeight / 100
  };
}

function checkCollision(rect1, rect2) {
  return rect1.x < rect2.x + rect2.width &&
         rect1.x + rect1.width > rect2.x &&
         rect1.y < rect2.y + rect2.height &&
         rect1.y + rect1.height > rect2.y;
}

function resetPlayer(initial = false) {
  if (!initial) {
    lives--;
    livesEl.textContent = lives;
    
    if (lives <= 0) {
      endGame();
      return;
    }
  }
  
  gameState.x = 100;
  gameState.y = 0;
  gameState.vx = 0;
  gameState.vy = 0;
  gameState.isJumping = false;
  gameState.onGround = true;
  
  // Reset view
  cameraX = 0;
  game.style.transform = 'translateX(0)';
}

function endGame() {
  gameRunning = false;
  gameOver.style.animation = 'gameOver 0.5s forwards';
  
  setTimeout(() => {
    gameOver.style.animation = 'none';
    gameOver.style.opacity = '0';
    startScreen.style.display = 'flex';
    
    // Reset game state
    score = 0;
    level = 1;
    lives = 3;
  }, 3000);
}

function gameLoop() {
  if (!gameRunning) {
    requestAnimationFrame(gameLoop);
    return;
  }
  
  // Handle input
  const leftPressed = keys['ArrowLeft'] || keys['KeyA'] || mobileControls.left;
  const rightPressed = keys['ArrowRight'] || keys['KeyD'] || mobileControls.right;
  const jumpPressed = keys['Space'] || keys['ArrowUp'] || keys['KeyW'] || mobileControls.jump;
  
  // Movement
  if (rightPressed) gameState.vx = physics.moveSpeed;
  else if (leftPressed) gameState.vx = -physics.moveSpeed;
  else gameState.vx *= physics.friction;
  
  // Jumping
  if (jumpPressed && gameState.onGround) {
    gameState.vy = physics.jumpStrength;
    gameState.isJumping = true;
    gameState.onGround = false;
  }
  
  // Apply physics
  gameState.vy -= physics.gravity;
  gameState.x += gameState.vx;
  gameState.y += gameState.vy;
  
  // Ground collision
  if (gameState.y <= 0) {
    gameState.y = 0; 
    gameState.vy = 0; 
    gameState.isJumping = false;
    gameState.onGround = true;
  }
  
  // Boundaries
  if (gameState.x < 0) gameState.x = 0;
  if (gameState.x > gameWidth - 50) gameState.x = gameWidth - 50;
  
  // Update player visual state
  player.classList.toggle('jumping', gameState.isJumping);
  
  // Update player position
  player.style.left = gameState.x + 'px';
  player.style.bottom = (15 * window.innerHeight / 100 + gameState.y) + 'px';
  
  // Player collision box
  const playerBox = {
    x: gameState.x, 
    y: gameState.y, 
    width: 50,
    height: 60
  };
  
  // Coin collection
  coins.forEach(coin => {
    if (coin.collected) return;
    
    const coinBox = {
      x: coin.x,
      y: 10,
      width: 35,
      height: 35
    };
    
    if (checkCollision(playerBox, coinBox)) {
      coin.element.style.display = 'none';
      coin.collected = true;
      score += 100 + (level * 20);
      scoreEl.textContent = score;
    }
  });
  
  // Obstacle collision
  obstacles.forEach(obs => {
    const obsBox = {
      x: obs.x,
      y: obs.y,
      width: obs.width,
      height: obs.height
    };
    
    if (checkCollision(playerBox, obsBox)) {
      if (obs.type === 'goomba' && gameState.vy < 0 && playerBox.y > obsBox.y + 20) {
        // Jumped on goomba
        obs.element.style.display = 'none';
        obstacles = obstacles.filter(o => o !== obs);
        score += 200 + (level * 50);
        scoreEl.textContent = score;
        gameState.vy = 8; // Bounce
      } else if (obs.type === 'block' && gameState.vy < 0) {
        // Hit block from below
        gameState.vy = 0;
        gameState.y = obsBox.y + obsBox.height;
      } else {
        resetPlayer();
        return;
      }
    }
  });
  
  // Flag collision (level complete)
  const flagBox = {
    x: flag.x,
    y: 0,
    width: flag.width,
    height: flag.height
  };
  
  if (checkCollision(playerBox, flagBox)) {
    level++;
    levelEl.textContent = level;
    
    // Show level up animation
    levelUp.style.animation = 'levelUp 2s ease-out';
    setTimeout(() => {
      levelUp.style.animation = 'none';
      levelUp.style.opacity = '0';
    }, 2000);
    
    // Setup next level
    setupLevel(level);
    
    // Bonus points for completing level
    score += 500 * level;
    scoreEl.textContent = score;
    
    // Reset player position but keep score/lives
    resetPlayer(true);
  }
  
  // Camera follow (smooth)
  const screenWidth = window.innerWidth;
  const targetX = Math.max(0, Math.min(gameState.x - screenWidth / 2, gameWidth - screenWidth));
  cameraX += (targetX - cameraX) * 0.1;
  game.style.transform = `translateX(-${cameraX}px)`;
  
  requestAnimationFrame(gameLoop);
}

// Keyboard controls
document.addEventListener('keydown', e => {
  if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'Space', 'KeyA', 'KeyD', 'KeyW'].includes(e.code)) {
    e.preventDefault();
    keys[e.code] = true;
  }
});

document.addEventListener('keyup', e => {
  if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'Space', 'KeyA', 'KeyD', 'KeyW'].includes(e.code)) {
    e.preventDefault();
    keys[e.code] = false;
  }
});

// Mobile controls - Fixed implementation
const leftBtn = document.getElementById('leftBtn');
const rightBtn = document.getElementById('rightBtn');
const jumpBtn = document.getElementById('jumpBtn');

// Left button
leftBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  mobileControls.left = true;
});

leftBtn.addEventListener('touchend', e => {
  e.preventDefault();
  mobileControls.left = false;
});

leftBtn.addEventListener('mousedown', e => {
  e.preventDefault();
  mobileControls.left = true;
});

leftBtn.addEventListener('mouseup', e => {
  e.preventDefault();
  mobileControls.left = false;
});

leftBtn.addEventListener('mouseleave', e => {
  mobileControls.left = false;
});

// Right button
rightBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  mobileControls.right = true;
});

rightBtn.addEventListener('touchend', e => {
  e.preventDefault();
  mobileControls.right = false;
});

rightBtn.addEventListener('mousedown', e => {
  e.preventDefault();
  mobileControls.right = true;
});

rightBtn.addEventListener('mouseup', e => {
  e.preventDefault();
  mobileControls.right = false;
});

rightBtn.addEventListener('mouseleave', e => {
  mobileControls.right = false;
});

// Jump button
jumpBtn.addEventListener('touchstart', e => {
  e.preventDefault();
  mobileControls.jump = true;
});

jumpBtn.addEventListener('touchend', e => {
  e.preventDefault();
  mobileControls.jump = false;
});

jumpBtn.addEventListener('mousedown', e => {
  e.preventDefault();
  mobileControls.jump = true;
});

jumpBtn.addEventListener('mouseup', e => {
  e.preventDefault();
  mobileControls.jump = false;
});

jumpBtn.addEventListener('mouseleave', e => {
  mobileControls.jump = false;
});

// Start game button
startBtn.addEventListener('click', initGame);

// Prevent touch scroll
document.addEventListener('touchmove', e => {
  if (gameRunning) e.preventDefault();
}, { passive: false });

// Initial setup - show start screen
startScreen.style.display = 'flex';
</script>

</body>
</html>