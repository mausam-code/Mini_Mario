<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario Game</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(to bottom, #5c94fc 0%, #87ceeb 100%);
        font-family: 'Courier New', monospace;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
    }

    .game {
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
    }

    .world {
        position: absolute;
        width: 5000px;
        height: 100vh;
        transition: transform 0.1s ease-out;
    }

    .ground {
        position: absolute;
        bottom: 0;
        height: min(100px, 15vh);
        width: 100%;
        background: linear-gradient(to bottom, #22c55e 0%, #16a34a 100%);
        border-top: 5px solid #15803d;
    }

    .player {
        position: absolute;
        bottom: min(100px, 15vh);
        left: min(100px, 15vw);
        width: min(40px, 6vw);
        height: min(50px, 7vh);
        z-index: 10;
        transition: transform 0.1s ease-out;
        background: #dc2626;
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        position: relative;
        overflow: visible;
    }

    /* Mario character design */
    .player::before {
        content: '';
        position: absolute;
        top: -5px;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
        height: 40%;
        background: #f59e0b;
        border-radius: 50%;
        z-index: 1;
    }

    .player::after {
        content: '';
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        height: 60%;
        background: #3b82f6;
        border-radius: 20% 20% 50% 50%;
        z-index: 2;
    }

    .player .hat {
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 85%;
        height: 25%;
        background: #dc2626;
        border-radius: 50% 50% 20% 20%;
        z-index: 3;
    }

    .player .hat::before {
        content: '';
        position: absolute;
        top: 60%;
        left: 50%;
        transform: translateX(-50%);
        width: 20%;
        height: 40%;
        background: #991b1b;
        border-radius: 50%;
    }

    .player .face {
        position: absolute;
        top: 15%;
        left: 50%;
        transform: translateX(-50%);
        width: 70%;
        height: 35%;
        background: #fbbf24;
        border-radius: 50%;
        z-index: 2;
    }

    .player .face::before {
        content: '';
        position: absolute;
        top: 30%;
        left: 25%;
        width: 15%;
        height: 20%;
        background: #000;
        border-radius: 50%;
        box-shadow: 30px 0 0 #000;
    }

    .player .face::after {
        content: '';
        position: absolute;
        bottom: 20%;
        left: 50%;
        transform: translateX(-50%);
        width: 40%;
        height: 15%;
        background: #8b4513;
        border-radius: 0 0 50% 50%;
    }

    .player.jumping {
        transform: rotate(15deg);
    }

    .player.moving {
        animation: walk 0.3s infinite;
    }

    @keyframes walk {
        0%, 100% { transform: scaleX(1) scaleY(1); }
        50% { transform: scaleX(1.05) scaleY(0.95); }
    }

    .obstacle {
        position: absolute;
        bottom: min(100px, 15vh);
        width: min(40px, 6vw);
        height: min(40px, 6vh);
        background: linear-gradient(45deg, #8b4513, #a0522d);
        border-radius: 5px;
        border: 2px solid #654321;
    }

    .pipe {
        position: absolute;
        bottom: min(100px, 15vh);
        width: min(60px, 9vw);
        background: linear-gradient(to right, #22c55e, #16a34a);
        border: 3px solid #15803d;
        border-radius: 10px 10px 0 0;
    }

    .coin {
        position: absolute;
        bottom: min(150px, 22vh);
        width: min(25px, 4vw);
        height: min(25px, 4vh);
        background: radial-gradient(circle, #fbbf24, #f59e0b);
        border-radius: 50%;
        border: 3px solid #d97706;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotateY(0deg); }
        100% { transform: rotateY(360deg); }
    }

    .platform {
        position: absolute;
        height: min(20px, 3vh);
        background: linear-gradient(to bottom, #dc2626, #b91c1c);
        border: 2px solid #991b1b;
        border-radius: 5px;
    }

    .cloud {
        position: absolute;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50px;
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    .hud {
        position: fixed;
        top: min(20px, 3vh);
        left: min(20px, 3vw);
        color: white;
        font-size: clamp(14px, 3vw, 20px);
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        z-index: 100;
    }

    .enemy {
        position: absolute;
        bottom: min(100px, 15vh);
        width: min(35px, 5vw);
        height: min(35px, 5vh);
        background: linear-gradient(45deg, #7c2d12, #92400e);
        border-radius: 50%;
        border: 2px solid #451a03;
        animation: enemyMove 2s linear infinite alternate;
    }

    @keyframes enemyMove {
        0% { transform: translateX(0px); }
        100% { transform: translateX(min(80px, 12vw)); }
    }

    .flag {
        position: absolute;
        bottom: min(100px, 15vh);
        width: min(10px, 2vw);
        height: min(200px, 30vh);
        background: #374151;
        border-radius: 5px;
    }

    .flag::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: min(50px, 7vw);
        height: min(80px, 12vh);
        background: linear-gradient(45deg, #dc2626, #ef4444);
        border: 2px solid #991b1b;
    }

    .game-over {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: clamp(20px, 5vw, 40px);
        border-radius: 20px;
        text-align: center;
        font-size: clamp(18px, 4vw, 24px);
        z-index: 1000;
        display: none;
        max-width: 90vw;
    }

    .restart-btn {
        margin-top: 20px;
        padding: clamp(8px, 2vw, 10px) clamp(16px, 4vw, 20px);
        font-size: clamp(14px, 3vw, 18px);
        background: #dc2626;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        touch-action: manipulation;
    }

    .restart-btn:hover {
        background: #b91c1c;
    }

    /* Mobile Controls */
    .mobile-controls {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
        gap: 10px;
        z-index: 100;
    }

    .control-btn {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        color: white;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        user-select: none;
        touch-action: manipulation;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
    }

    .control-btn:active {
        background: rgba(255, 255, 255, 0.4);
        transform: scale(0.95);
    }

    .control-btn.jump {
        background: rgba(255, 0, 0, 0.3);
        border-color: rgba(255, 0, 0, 0.5);
    }

    @media (max-width: 768px) {
        .mobile-controls {
            display: flex;
        }
        
        .hud {
            font-size: clamp(12px, 4vw, 16px);
        }
        
        .game-over {
            font-size: clamp(16px, 5vw, 20px);
        }
    }

    @media (max-width: 480px) {
        .control-btn {
            width: 50px;
            height: 50px;
            font-size: 16px;
        }
    }

    /* Responsive adjustments */
    @media (max-height: 500px) {
        .ground {
            height: 80px;
        }
        
        .player {
            bottom: 80px;
            height: 40px;
        }
        
        .obstacle, .enemy {
            bottom: 80px;
        }
        
        .pipe {
            bottom: 80px;
        }
        
        .coin {
            bottom: 120px;
        }
    }
</style>
<body>
    <div class="game">
        <div class="world" id="world">
            <div class="player" id="player">
                <div class="hat"></div>
                <div class="face"></div>
            </div>
            <div class="ground"></div>
            
            <!-- Obstacles -->
            <div class="obstacle" style="left: 300px;"></div>
            <div class="obstacle" style="left: 600px;"></div>
            <div class="obstacle" style="left: 900px;"></div>
            
            <!-- Pipes -->
            <div class="pipe" style="left: 450px; height: min(80px, 12vh);"></div>
            <div class="pipe" style="left: 800px; height: min(120px, 18vh);"></div>
            <div class="pipe" style="left: 1200px; height: min(100px, 15vh);"></div>
            
            <!-- Coins -->
            <div class="coin" style="left: 250px;"></div>
            <div class="coin" style="left: 350px;"></div>
            <div class="coin" style="left: 550px;"></div>
            <div class="coin" style="left: 750px;"></div>
            <div class="coin" style="left: 950px;"></div>
            <div class="coin" style="left: 1050px;"></div>
            <div class="coin" style="left: 1300px;"></div>
            <div class="coin" style="left: 1500px;"></div>
            
            <!-- Platforms -->
            <div class="platform" style="left: 400px; bottom: min(200px, 30vh); width: min(100px, 15vw);"></div>
            <div class="platform" style="left: 650px; bottom: min(250px, 37vh); width: min(80px, 12vw);"></div>
            <div class="platform" style="left: 1000px; bottom: min(300px, 45vh); width: min(120px, 18vw);"></div>
            
            <!-- Enemies -->
            <div class="enemy" style="left: 500px;"></div>
            <div class="enemy" style="left: 850px;"></div>
            <div class="enemy" style="left: 1100px;"></div>
            
            <!-- Clouds -->
            <div class="cloud" style="left: 200px; top: min(50px, 8vh); width: min(80px, 12vw); height: min(40px, 6vh);"></div>
            <div class="cloud" style="left: 500px; top: min(80px, 12vh); width: min(100px, 15vw); height: min(50px, 7vh);"></div>
            <div class="cloud" style="left: 800px; top: min(40px, 6vh); width: min(90px, 13vw); height: min(45px, 6vh);"></div>
            <div class="cloud" style="left: 1200px; top: min(70px, 10vh); width: min(110px, 16vw); height: min(55px, 8vh);"></div>
            
            <!-- Flag at the end -->
            <div class="flag" style="left: 1800px;"></div>
        </div>
        
        <div class="hud">
            <div>Score: <span id="score">0</span></div>
            <div>Lives: <span id="lives">3</span></div>
            <div>Level: <span id="level">1</span></div>
        </div>
        
        <div class="mobile-controls">
            <div class="control-btn" id="leftBtn">←</div>
            <div class="control-btn jump" id="jumpBtn">↑</div>
            <div class="control-btn" id="rightBtn">→</div>
        </div>
        
        <div class="game-over" id="gameOver">
            <div>Game Over!</div>
            <div style="font-size: 0.8em; margin-top: 10px;">Final Score: <span id="finalScore">0</span></div>
            <button class="restart-btn" onclick="restartGame()">Play Again</button>
        </div>
    </div>

    <script>
        const player = document.getElementById("player");
        const world = document.getElementById("world");
        const scoreElement = document.getElementById("score");
        const livesElement = document.getElementById("lives");
        const levelElement = document.getElementById("level");
        const gameOverElement = document.getElementById("gameOver");
        const finalScoreElement = document.getElementById("finalScore");
        
        // Mobile controls
        const leftBtn = document.getElementById("leftBtn");
        const rightBtn = document.getElementById("rightBtn");
        const jumpBtn = document.getElementById("jumpBtn");
        
        let gameState = {
            positionX: Math.min(100, window.innerWidth * 0.15),
            positionY: 0,
            velocityY: 0,
            velocityX: 0,
            isJumping: false,
            isMoving: false,
            worldOffset: 0,
            score: 0,
            lives: 3,
            level: 1,
            gameRunning: true,
            keys: {},
            jumpPressed: false
        };
        
        const physics = {
            gravity: 0.6,
            jumpStrength: 15,
            moveSpeed: 6,
            friction: 0.8,
            maxSpeed: 8
        };
        
        // Responsive scaling
        function getScaleFactor() {
            return Math.min(window.innerWidth / 1200, window.innerHeight / 800);
        }
        
        function updateResponsiveValues() {
            const scale = getScaleFactor();
            physics.moveSpeed = 6 * scale;
            physics.maxSpeed = 8 * scale;
            physics.jumpStrength = 15 * scale;
        }
        
        // Input handling
        document.addEventListener("keydown", (e) => {
            gameState.keys[e.code] = true;
        });
        
        document.addEventListener("keyup", (e) => {
            gameState.keys[e.code] = false;
        });
        
        // Mobile touch controls
        leftBtn.addEventListener("touchstart", (e) => {
            e.preventDefault();
            gameState.keys["ArrowLeft"] = true;
        });
        
        leftBtn.addEventListener("touchend", (e) => {
            e.preventDefault();
            gameState.keys["ArrowLeft"] = false;
        });
        
        rightBtn.addEventListener("touchstart", (e) => {
            e.preventDefault();
            gameState.keys["ArrowRight"] = true;
        });
        
        rightBtn.addEventListener("touchend", (e) => {
            e.preventDefault();
            gameState.keys["ArrowRight"] = false;
        });
        
        jumpBtn.addEventListener("touchstart", (e) => {
            e.preventDefault();
            gameState.keys["Space"] = true;
        });
        
        jumpBtn.addEventListener("touchend", (e) => {
            e.preventDefault();
            gameState.keys["Space"] = false;
        });
        
        // Prevent scrolling on mobile
        document.addEventListener("touchmove", (e) => {
            e.preventDefault();
        }, { passive: false });
        
        function handleInput() {
            if (!gameState.gameRunning) return;
            
            // Movement Left/right
            if (gameState.keys["ArrowRight"] || gameState.keys["KeyD"]) {
                gameState.velocityX = Math.min(gameState.velocityX + 0.5, physics.maxSpeed);
                gameState.isMoving = true;
                player.style.transform = 'scaleX(1)';
            } else if (gameState.keys["ArrowLeft"] || gameState.keys["KeyA"]) {
                gameState.velocityX = Math.max(gameState.velocityX - 0.5, -physics.maxSpeed);
                gameState.isMoving = true;
                player.style.transform = 'scaleX(-1)';
            } else {
                gameState.velocityX *= physics.friction;
                gameState.isMoving = Math.abs(gameState.velocityX) > 0.1;
            }
            
            // Jumping only when key first pressed
            if ((gameState.keys["Space"] || gameState.keys["ArrowUp"] || gameState.keys["KeyW"])) {
                if (!gameState.jumpPressed && !gameState.isJumping){
                    gameState.velocityY = -physics.jumpStrength;
                    gameState.isJumping = true;
                    gameState.jumpPressed = true;
                    player.classList.add('jumping');
                }
            } else {
                gameState.jumpPressed = false;
            }
        }
        
        function updatePhysics() {
            // Apply gravity
            gameState.velocityY += physics.gravity;
            
            // Update positions
            gameState.positionX += gameState.velocityX;
            gameState.positionY += gameState.velocityY;
            
            // Ground collision
            const groundHeight = Math.min(100, window.innerHeight * 0.15);
            if (gameState.positionY > 0) {
                gameState.positionY = 0;
                gameState.velocityY = 0;
                gameState.isJumping = false;
                player.classList.remove('jumping');
            }
            
            // Boundary checks
            if (gameState.positionX < 0) {
                gameState.positionX = 0;
                gameState.velocityX = 0;
            }
            
            // Update visual movement class
            if (gameState.isMoving) {
                player.classList.add('moving');
            } else {
                player.classList.remove('moving');
            }
        }
        
        function updateCamera() {
            const targetOffset = Math.max(0, gameState.positionX - window.innerWidth * 0.4);
            gameState.worldOffset = targetOffset;
            world.style.transform = `translateX(-${gameState.worldOffset}px)`;
        }
        
        function checkCollisions() {
            const playerWidth = Math.min(40, window.innerWidth * 0.06);
            const playerHeight = Math.min(50, window.innerHeight * 0.07);
            const groundHeight = Math.min(100, window.innerHeight * 0.15);
            
            const playerRect = {
                left: gameState.positionX,
                right: gameState.positionX + playerWidth,
                top: groundHeight + gameState.positionY,
                bottom: groundHeight + gameState.positionY + playerHeight
            };
            
            // Check coin collisions
            const coins = document.querySelectorAll('.coin');
            coins.forEach(coin => {
                if (coin.style.display === 'none') return;
                
                const coinLeft = parseInt(coin.style.left);
                const coinSize = Math.min(25, window.innerWidth * 0.04);
                const coinRect = {
                    left: coinLeft,
                    right: coinLeft + coinSize,
                    top: Math.min(150, window.innerHeight * 0.22),
                    bottom: Math.min(175, window.innerHeight * 0.26)
                };
                
                if (isColliding(playerRect, coinRect)) {
                    coin.style.display = 'none';
                    gameState.score += 100;
                    updateHUD();
                }
            });
            
            // Check enemy collisions
            const enemies = document.querySelectorAll('.enemy');
            enemies.forEach(enemy => {
                if (enemy.style.display === 'none') return;
                
                const enemyLeft = parseInt(enemy.style.left);
                const enemySize = Math.min(35, window.innerWidth * 0.05);
                const enemyRect = {
                    left: enemyLeft,
                    right: enemyLeft + enemySize,
                    top: groundHeight,
                    bottom: groundHeight + enemySize
                };
                
                if (isColliding(playerRect, enemyRect)) {
                    if (gameState.velocityY > 0 && playerRect.bottom - 10 < enemyRect.top) {
                        enemy.style.display = 'none';
                        gameState.score += 200;
                        gameState.velocityY = -8;
                        updateHUD();
                    } else {
                        takeDamage();
                    }
                }
            });
            
            // Check obstacle collisions
            const obstacles = document.querySelectorAll('.obstacle');
            obstacles.forEach(obstacle => {
                const obstacleLeft = parseInt(obstacle.style.left);
                const obstacleSize = Math.min(40, window.innerWidth * 0.06);
                const obstacleRect = {
                    left: obstacleLeft,
                    right: obstacleLeft + obstacleSize,
                    top: groundHeight,
                    bottom: groundHeight + obstacleSize
                };
                
                if (isColliding(playerRect, obstacleRect)) {
                    if (gameState.velocityX > 0) {
                        gameState.positionX = obstacleLeft - playerWidth;
                    } else {
                        gameState.positionX = obstacleLeft + obstacleSize;
                    }
                    gameState.velocityX = 0;
                }
            });
            
            // Check pipe collisions
            const pipes = document.querySelectorAll('.pipe');
            pipes.forEach(pipe => {
                const pipeLeft = parseInt(pipe.style.left);
                const pipeWidth = Math.min(60, window.innerWidth * 0.09);
                const pipeHeight = parseInt(pipe.style.height);
                const pipeRect = {
                    left: pipeLeft,
                    right: pipeLeft + pipeWidth,
                    top: groundHeight,
                    bottom: groundHeight + pipeHeight
                };
                
                if (isColliding(playerRect, pipeRect)) {
                    if (gameState.velocityX > 0) {
                        gameState.positionX = pipeLeft - playerWidth;
                    } else {
                        gameState.positionX = pipeLeft + pipeWidth;
                    }
                    gameState.velocityX = 0;
                }
            });
            
            // Check platform collisions
            const platforms = document.querySelectorAll('.platform');
            platforms.forEach(platform => {
                const platformLeft = parseInt(platform.style.left);
                const platformBottom = parseInt(platform.style.bottom);
                const platformWidth = parseInt(platform.style.width);
                const platformHeight = Math.min(20, window.innerHeight * 0.03);
                const platformRect = {
                    left: platformLeft,
                    right: platformLeft + platformWidth,
                    top: platformBottom,
                    bottom: platformBottom + platformHeight
                };
                
                if (isColliding(playerRect, platformRect) && gameState.velocityY > 0) {
                    gameState.positionY = -(platformBottom + platformHeight - groundHeight);
                    gameState.velocityY = 0;
                    gameState.isJumping = false;
                    player.classList.remove('jumping');
                }
            });
            
            // Check flag collision
            const flag = document.querySelector('.flag');
            const flagLeft = parseInt(flag.style.left);
            const flagWidth = Math.min(60, window.innerWidth * 0.09);
            const flagHeight = Math.min(200, window.innerHeight * 0.3);
            const flagRect = {
                left: flagLeft,
                right: flagLeft + flagWidth,
                top: groundHeight,
                bottom: groundHeight + flagHeight
            };
            
            if (isColliding(playerRect, flagRect)) {
                gameState.score += 1000;
                gameState.level++;
                updateHUD();
            }
            
            // Fall off the world
            if (gameState.positionY > 200) {
                takeDamage();
            }
        }
        
        function isColliding(rect1, rect2) {
            return rect1.left < rect2.right &&
                   rect1.right > rect2.left &&
                   rect1.top < rect2.bottom &&
                   rect1.bottom > rect2.top;
        }
        
        function takeDamage() {
            gameState.lives--;
            updateHUD();
            
            if (gameState.lives <= 0) {
                gameOver();
            } else {
                gameState.positionX = Math.min(100, window.innerWidth * 0.15);
                gameState.positionY = 0;
                gameState.velocityX = 0;
                gameState.velocityY = 0;
                gameState.worldOffset = 0;
            }
        }
        
        function gameOver() {
            gameState.gameRunning = false;
            finalScoreElement.textContent = gameState.score;
            gameOverElement.style.display = 'block';
        }
        
        function restartGame() {
            gameState = {
                positionX: Math.min(100, window.innerWidth * 0.15),
                positionY: 0,
                velocityY: 0,
                velocityX: 0,
                isJumping: false,
                isMoving: false,
                worldOffset: 0,
                score: 0,
                lives: 3,
                level: 1,
                gameRunning: true,
                keys: {},
                jumpPressed: false
            };
            
            document.querySelectorAll('.coin').forEach(coin => {
                coin.style.display = 'block';
            });
            
            document.querySelectorAll('.enemy').forEach(enemy => {
                enemy.style.display = 'block';
            });
            
            gameOverElement.style.display = 'none';
            updateHUD();
            world.style.transform = 'translateX(0px)';
        }
        
        function updateHUD() {
            scoreElement.textContent = gameState.score;
            livesElement.textContent = gameState.lives;
            levelElement.textContent = gameState.level;
        }
        
        function updateVisuals() {
            const groundHeight = Math.min(100, window.innerHeight * 0.15);
            player.style.left = gameState.positionX + "px";
            player.style.bottom = (groundHeight + gameState.positionY) + "px";
        }
        
        function gameLoop() {
            if (gameState.gameRunning) {
                handleInput();
                updatePhysics();
                updateCamera();
                checkCollisions();
                updateVisuals();
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            updateResponsiveValues();
        });
        
        // Initialize
        updateResponsiveValues();
        updateHUD();
        gameLoop();
    </script>
</body>
</html>