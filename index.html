<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mario Game Extended</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { width:100%; height:100%; overflow:hidden; background:skyblue; font-family:sans-serif; }
  .game {
    position: relative; width: 2000px; height: 100vh;
    background: linear-gradient(to bottom, #5c94fc 0%, #87ceeb 100%);
  }
  .ground {
    position: absolute; bottom:0; width:100%; height:80px;
    background: linear-gradient(to bottom, #228B22, #006400);
  }
  .player {
    position: absolute; width:40px; height:50px; background:red;
    border-radius:10px; bottom:80px; left:100px;
  }
  .coin {
    position: absolute; width:20px; height:20px; background:gold;
    border-radius:50%; bottom:100px;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {0%{transform:rotateY(0deg);}100%{transform:rotateY(360deg);}}
  .flag {
    position: absolute; width:10px; height:120px; background:#444;
    bottom:80px; 
  }
  .flag::after {
    content:''; position:absolute; top:0; left:10px;
    width:40px; height:25px; background:red;
  }
  .hud {
    position:fixed; top:10px; left:10px; color:white; font-size:18px; text-shadow:1px 1px 2px black; z-index:100;
  }
  .mobile-buttons {
    position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
    display:flex; gap:10px; z-index:100;
  }
  .btn {
    width:60px; height:60px; background:rgba(0,0,0,0.3); color:white; font-size:20px;
    border:2px solid white; border-radius:10px; display:flex; align-items:center; justify-content:center;
    user-select:none;
  }
  .btn:active { background:rgba(255,255,255,0.2); }
</style>
</head>
<body>

<div class="game" id="game">
  <div class="ground"></div>
  <div class="player" id="player"></div>
  <!-- Coins closer to ground -->
  <div class="coin" style="left:300px;"></div>
  <div class="coin" style="left:500px;"></div>
  <div class="coin" style="left:800px;"></div>
  <!-- Flag at end -->
  <div class="flag" style="left:1000px;"></div>
</div>

<div class="hud">
  Score: <span id="score">0</span> | Level: <span id="level">1</span>
</div>

<div class="mobile-buttons">
  <div class="btn" id="leftBtn">←</div>
  <div class="btn" id="jumpBtn">↑</div>
  <div class="btn" id="rightBtn">→</div>
</div>

<script>
const player = document.getElementById('player');
const coins = document.querySelectorAll('.coin');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const flag = document.querySelector('.flag');

let score = 0, level=1;
let gameState = { x:100, y:0, vx:0, vy:0, isJumping:false };
const physics = { gravity:0.5, jumpStrength:10, moveSpeed:4, friction:0.9 };
let keys = {};

// Keyboard
document.addEventListener('keydown', e=> keys[e.code]=true);
document.addEventListener('keyup', e=> keys[e.code]=false);

// Mobile
let left=false, right=false, jump=false;
document.getElementById('leftBtn').addEventListener('touchstart', e=>{e.preventDefault();left=true;});
document.getElementById('leftBtn').addEventListener('touchend', e=>{e.preventDefault();left=false;});
document.getElementById('rightBtn').addEventListener('touchstart', e=>{e.preventDefault();right=true;});
document.getElementById('rightBtn').addEventListener('touchend', e=>{e.preventDefault();right=false;});
document.getElementById('jumpBtn').addEventListener('touchstart', e=>{e.preventDefault();jump=true;});
document.getElementById('jumpBtn').addEventListener('touchend', e=>{e.preventDefault();jump=false;});

// Loop
function gameLoop(){
  // Move
  if(keys['ArrowRight']||right) gameState.vx=physics.moveSpeed;
  else if(keys['ArrowLeft']||left) gameState.vx=-physics.moveSpeed;
  else gameState.vx*=physics.friction;

  // Jump
  if((keys['Space']||jump) && !gameState.isJumping){
    gameState.vy=physics.jumpStrength;
    gameState.isJumping=true;
  }

  // Apply gravity
  gameState.vy -= physics.gravity;

  // Update pos
  gameState.x+=gameState.vx;
  gameState.y+=gameState.vy;

  // Ground
  if(gameState.y<=0){
    gameState.y=0; gameState.vy=0; gameState.isJumping=false;
  }

  // Stay in bounds
  if(gameState.x<0) gameState.x=0;

  // Update DOM
  player.style.left=gameState.x+'px';
  player.style.bottom=(80+gameState.y)+'px';

  // Coins
  coins.forEach(coin=>{
    if(coin.style.display==='none') return;
    let cx=parseInt(coin.style.left);
    if(Math.abs(gameState.x - cx)<30){
      coin.style.display='none';
      score+=100; scoreEl.textContent=score;
    }
  });

  // Flag reach
  let flagX = parseInt(flag.style.left);
  if(gameState.x+40 > flagX){
    level+=1; levelEl.textContent=level;
    gameState.x=100; // restart at start
    // reset coins
    coins.forEach(c=>c.style.display='block');
  }

  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>

</body>
</html>
